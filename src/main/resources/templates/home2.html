<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>home</title>
</head>
<body>
    <h1>Car Reservation - Step 1: Find Available Cars</h1>
    <form id="car-reservation-form">
        <label for="reserver-name">Your Name:</label>
        <input type="text" id="reserver-name" name="reserverName" required>
        <br>
        <label for="reserver-phone-number">Phone Number:</label>
        <input type="tel" id="reserver-phone-number" name="reserverPhoneNumber" required>
        <br>
        <label for="source-city">Source City:</label>
        <input type="text" id="source-city" name="sourceCity" required>
        <br>
        <label for="destination-city">Destination City:</label>
        <input type="text" id="destination-city" name="destinationCity" required>
        <br>
        <label for="pickup-location">Pick-up Location:</label>
        <input type="text" id="pickup-location" name="pickupLocation" required>
        <br>
        <label for="dropoff-location">Drop-off Location (optional):</label>
        <input type="text" id="dropoff-location" name="dropoffLocation">
        <br>
        <label for="pickup-date">Pick-up Date:</label>
        <input type="date" id="pickup-date" name="pickupDate" required>
        <br>
        <label for="pickup-time">Pick-up Time:</label>
        <input type="time" id="pickup-time" name="startDateTime" required>
        <br>
        <label for="dropoff-date">Drop-off Date:</label>
        <input type="date" id="dropoff-date" name="dropoffDate" required>
        <br>
        <label for="dropoff-time">Drop-off Time:</label>
        <input type="time" id="dropoff-time" name="endDateTime" required>
        <br>
        <label for="seating-capacity">Seating Capacity:</label>
        <select id="seating-capacity" name="seatingCapacity" required>
            <option value="">Select</option>
            <option value="5">5</option>
            <option value="7">7</option>
        </select>
        <br>
        <button type="submit">Find Available Cars</button>
    </form>
    <div id="available-cars"></div>

    <script>
       const form = document.getElementById('car-reservation-form');
        console.log("hii2 " + form);
       const availableCarsDiv = document.getElementById('available-cars');

       form.addEventListener('submit', async (event) => {
       event.preventDefault(); // Prevent default form submission

       const formData = new FormData(form);
       const reservationRequest = {
       reserverName: formData.get('reserverName'),
       reserverPhoneNumber: formData.get('reserverPhoneNumber'),
       sourceCity: formData.get('sourceCity'),
       destinationCity: formData.get('destinationCity'),
       pickupLocation: formData.get('pickupLocation'),
       dropoffLocation: formData.get('dropoffLocation') || '',
       startDateTime: new Date(`${formData.get('pickupDate')} ${formData.get('startDateTime')}`),
       endDateTime: new Date(`${formData.get('dropoffDate')} ${formData.get('endDateTime')}`),
       seatingCapacity: parseInt(formData.get('seatingCapacity')),
       };

       try {
       const response = await fetch('/api/cars', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify(reservationRequest)
       });

       if (!response.ok) {
         console.error('Error fetching available cars:', response.statusText);
         return;
       }

       const availableCars = await response.json();

       availableCarsDiv.innerHTML = '<h2>Available Cars</h2>';
       availableCars.forEach(car => {
         const carDetails = `<p><b>${car.name}</b> - ${car.plate} </p>`;
         availableCarsDiv.innerHTML += carDetails;
       });
       } catch (error) {
       console.error('Error fetching available cars:', error);
       }
       });


    availableCarsDiv.addEventListener('click', (event) => {
    const clickedElement = event.target;
    if (clickedElement.tagName === 'P') {
        const carId = clickedElement.dataset.carId;

        fetch(`/api/book/${carId}`, {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            // Handle successful booking response (e.g., display confirmation message)
        })
        .catch(error => {
            console.error('Error booking car:', error);
            // Handle booking error
        });
    }
});



    </script>
</body>
</html>
