<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>home</title>
</head>
<body>
    <h1>Car Reservation - Step 1: Find Available Cars</h1>
    <form id="car-reservation-form">
        <label for="reserver-name">Your Name:</label>
        <input type="text" id="reserver-name" name="reserverName" th:value="${userName}" required>
        <br>
        <label for="reserver-phone-number">Phone Number:</label>
        <input type="tel" id="reserver-phone-number" name="reserverPhoneNumber"  th:value="${phoneNumber}"  required>
        <br>
        <p>Source City:
            <select id="source-city" name="sourceCity" required>
                <option value="">Select Origin City</option>
                <option th:each="city : ${servicableCities}" th:value="${city.name}" th:text="${city.name}"></option>
            </select>
        </p>
        <br>
        <p>Destination City:
            <select id="destination-city" name="destinationCity" required>
                <option value="">Select Destination City</option>
                <option th:each="city : ${servicableCities}" th:value="${city.name}" th:text="${city.name}"></option>
            </select>
        </p>
        <br>
        <label for="pickup-location">Pick-up Location:</label>
        <input type="text" id="pickup-location" name="pickupLocation" required>
        <br>
        <label for="dropoff-location">Drop-off Location (optional):</label>
        <input type="text" id="dropoff-location" name="dropoffLocation">
        <br>
        <label for="pickup-date">Pick-up Date:</label>
        <input type="date" id="pickup-date" name="pickupDate" required>
        <br>
        <label for="pickup-time">Pick-up Time:</label>
        <input type="time" id="pickup-time" name="startDateTime" required>
        <br>
        <label for="dropoff-date">Drop-off Date:</label>
        <input type="date" id="dropoff-date" name="dropoffDate" required>
        <br>
        <label for="dropoff-time">Drop-off Time:</label>
        <input type="time" id="dropoff-time" name="endDateTime" required>
        <br>
        <label for="seating-capacity">Seating Capacity:</label>
        <select id="seating-capacity" name="seatingCapacity" required>
            <option value="">Select</option>
            <option value="5">5</option>
            <option value="7">7</option>
        </select>
        <br>
        <button type="submit">Find Available Cars</button>
    </form>
<!--    <div id="available-cars"></div>-->

    <div id="available-cars">
        <h2>Available Cars</h2>
        <ul>
            <li th:each="car : ${availableCars}">
                <b>${car.name}</b> - ${car.plate}
                <button type="button" class="book-now-btn" data-car-id="${car.id}">Book Now</button>
            </li>
        </ul>
    </div>



    <script>
       const form = document.getElementById('car-reservation-form');
       const availableCarsDiv = document.getElementById('available-cars');

       form.addEventListener('submit', async (event) => {
       event.preventDefault();

       const formData = new FormData(form);
       const reservationRequest = {
       reserverName: formData.get('reserverName'),
       reserverPhoneNumber: formData.get('reserverPhoneNumber'),
       sourceCity: formData.get('sourceCity'),
       destinationCity: formData.get('destinationCity'),
       pickupLocation: formData.get('pickupLocation'),
       dropoffLocation: formData.get('dropoffLocation') || '',
       startDateTime: new Date(`${formData.get('pickupDate')} ${formData.get('startDateTime')}`),
       endDateTime: new Date(`${formData.get('dropoffDate')} ${formData.get('endDateTime')}`),
       seatingCapacity: parseInt(formData.get('seatingCapacity')),
       };

       try {
       const response = await fetch('/api/cars', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify(reservationRequest)
       });

       if (!response.ok) {
         console.error('Error fetching available cars:', response.statusText);
         return;
       }

       const availableCars = await response.json();

       availableCarsDiv.innerHTML = '<h2>Available Cars</h2>';
       availableCars.forEach(car => {
         const carDetails = `<p><b>${car.name}</b> - ${car.plate} </p>`;
         availableCarsDiv.innerHTML += carDetails;
       });
       } catch (error) {
       console.error('Error fetching available cars:', error);
       }
       });



    </script>
</body>
</html>
